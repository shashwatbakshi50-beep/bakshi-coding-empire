<script>

/* ================= ADMIN SETUP ================= */

// Auto create default admin if not exists
if(!localStorage.getItem("adminUser")){
    const defaultAdmin = {
        email: "shashwatbakshi80@outlook.com",
        password: btoa("admin@123") // simple encoded
    };
    localStorage.setItem("adminUser", JSON.stringify(defaultAdmin));
}

/* ================= LOGIN SYSTEM ================= */

function login(){
let email=document.getElementById("email").value;
let password=document.getElementById("password").value;

let admin = JSON.parse(localStorage.getItem("adminUser"));

if(email === admin.email && btoa(password) === admin.password){
    localStorage.setItem("adminAuth","true");
    showDashboard();
}else{
    alert("Invalid Email or Password");
}
}

function showDashboard(){
document.getElementById("loginPage").style.display="none";
document.getElementById("dashboard").style.display="block";
loadGames();
}

// Prevent direct access
window.onload=function(){
if(localStorage.getItem("adminAuth")==="true"){
showDashboard();
}
}

function logout(){
localStorage.removeItem("adminAuth");
location.reload();
}

/* ================= CHANGE PASSWORD ================= */

function changePassword(){
let newPass = prompt("Enter New Password:");
if(!newPass) return;

let admin = JSON.parse(localStorage.getItem("adminUser"));
admin.password = btoa(newPass);
localStorage.setItem("adminUser", JSON.stringify(admin));
alert("Password Updated Successfully");
}

/* ================= ADD GAME ================= */

function addGame(){

let name=document.getElementById("gameName").value;
let price=document.getElementById("gamePrice").value;
let file=document.getElementById("gameFile").files[0];
let image=document.getElementById("gameImage").files[0];

if(!name || !price){
alert("Fill all fields");
return;
}

let reader=new FileReader();
let imgReader=new FileReader();

let games=JSON.parse(localStorage.getItem("games"))||[];

let newGame={
id:Date.now(),
name:name,
price:price,
fileName:file?file.name:"",
fileData:"",
imageData:""
};

if(file){
reader.onload=function(e){
newGame.fileData=e.target.result;
saveImage();
};
reader.readAsDataURL(file);
}else{
saveImage();
}

function saveImage(){
if(image){
imgReader.onload=function(e){
newGame.imageData=e.target.result;
saveGame();
};
imgReader.readAsDataURL(image);
}else{
saveGame();
}
}

function saveGame(){
games.push(newGame);
localStorage.setItem("games",JSON.stringify(games));
loadGames();
alert("Game Added Successfully");
}
}

/* ================= LOAD GAMES ================= */

function loadGames(){
let games=JSON.parse(localStorage.getItem("games"))||[];
let list=document.getElementById("gameList");
list.innerHTML="";

games.forEach(g=>{
list.innerHTML+=`
<div class="game-card">

<div class="game-info">
<h3>${g.name}</h3>
<p>Price: â‚¹${g.price}</p>
<p>File: ${g.fileName}</p>

<button class="btn-primary" onclick="downloadGame('${g.fileData}','${g.fileName}')">Download</button>
<button class="btn-danger" onclick="deleteGame(${g.id})">Delete</button>
</div>

<div>
${g.imageData?`<img src="${g.imageData}">`:""}
</div>

</div>
`;
});
}

/* ================= DOWNLOAD ================= */

function downloadGame(data,fileName){
if(!data){
alert("No File Uploaded");
return;
}
let a=document.createElement("a");
a.href=data;
a.download=fileName;
a.click();
}

/* ================= DELETE ================= */

function deleteGame(id){
let games=JSON.parse(localStorage.getItem("games"))||[];
games=games.filter(g=>g.id!==id);
localStorage.setItem("games",JSON.stringify(games));
loadGames();
}

</script>
